<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>RISE Agent Architecture</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{background:#0f172a;color:#e2e8f0;font-family:'Inter',system-ui,sans-serif;min-height:100vh;overflow-x:auto}
#toolbar{position:sticky;top:0;z-index:100;background:#1e293b;border-bottom:1px solid #334155;padding:12px 24px;display:flex;gap:12px;align-items:center}
#toolbar h1{font-size:18px;font-weight:700;color:#f8fafc;margin-right:auto}
.btn{padding:8px 16px;border-radius:8px;border:none;font-family:inherit;font-size:13px;font-weight:600;cursor:pointer;transition:all .2s}
.btn-blue{background:#3b82f6;color:#fff}.btn-blue:hover{background:#2563eb}
.btn-green{background:#10b981;color:#fff}.btn-green:hover{background:#059669}
.btn-amber{background:#f59e0b;color:#1e293b}.btn-amber:hover{background:#d97706}
.btn-red{background:#ef4444;color:#fff}.btn-red:hover{background:#dc2626}
#canvas{position:relative;min-width:1200px;min-height:900px;padding:40px}
svg#lines{position:absolute;top:0;left:0;width:100%;height:100%;pointer-events:none;z-index:1}
.node{position:absolute;z-index:10;border-radius:12px;padding:12px 16px;cursor:grab;user-select:none;transition:box-shadow .2s;min-width:140px;text-align:center}
.node:hover{box-shadow:0 0 20px rgba(255,255,255,.15);z-index:20}
.node.dragging{opacity:.85;cursor:grabbing;z-index:50}
.node .name{font-weight:700;font-size:13px;white-space:nowrap}
.node .role{font-size:10px;opacity:.8;margin-top:2px}
.node .phase{position:absolute;top:-8px;right:-8px;background:#475569;color:#f8fafc;font-size:9px;font-weight:700;padding:2px 6px;border-radius:10px}
.node .delete-btn{position:absolute;top:-8px;left:-8px;width:20px;height:20px;background:#ef4444;color:#fff;border:none;border-radius:50%;font-size:12px;cursor:pointer;display:none;align-items:center;justify-content:center;line-height:1}
.node:hover .delete-btn{display:flex}
.team-box{position:absolute;border-radius:16px;border:2px solid;z-index:2;padding:16px;padding-top:40px}
.team-box .team-label{position:absolute;top:12px;left:16px;font-size:13px;font-weight:700;letter-spacing:.5px}
.shared-bar{position:absolute;z-index:3;border-radius:12px;border:2px dashed #2dd4bf;background:rgba(45,212,191,.08);padding:16px;padding-top:36px}
.shared-bar .team-label{position:absolute;top:10px;left:16px;font-size:13px;font-weight:700;color:#2dd4bf}
.infra-bar{position:absolute;z-index:2;background:#1e293b;border:1px solid #334155;border-radius:12px;padding:16px;display:flex;gap:24px;justify-content:center;align-items:center}
.infra-item{background:#334155;padding:8px 18px;border-radius:8px;font-size:12px;font-weight:600;color:#94a3b8}
#legend{position:absolute;z-index:5;background:#1e293bdd;border:1px solid #334155;border-radius:12px;padding:16px;font-size:11px;line-height:1.8}
#legend h3{font-size:13px;margin-bottom:8px;color:#f8fafc}
.legend-item{display:flex;align-items:center;gap:8px}
.legend-swatch{width:14px;height:14px;border-radius:4px;flex-shrink:0}
.legend-line{width:24px;height:0;border-top:2px solid;flex-shrink:0}
.modal-overlay{display:none;position:fixed;inset:0;background:rgba(0,0,0,.6);z-index:200;align-items:center;justify-content:center}
.modal-overlay.open{display:flex}
.modal{background:#1e293b;border:1px solid #475569;border-radius:16px;padding:24px;width:380px;max-width:90vw}
.modal h2{margin-bottom:16px;font-size:16px}
.modal label{display:block;font-size:12px;font-weight:600;margin-top:10px;color:#94a3b8}
.modal input,.modal select,.modal textarea{width:100%;padding:8px 10px;border-radius:8px;border:1px solid #475569;background:#0f172a;color:#e2e8f0;font-family:inherit;font-size:13px;margin-top:4px}
.modal textarea{height:60px;resize:vertical}
.modal-actions{display:flex;gap:10px;margin-top:18px;justify-content:flex-end}
#tooltip{display:none;position:fixed;z-index:300;background:#1e293b;border:1px solid #475569;border-radius:8px;padding:10px 14px;font-size:12px;max-width:250px;pointer-events:none;box-shadow:0 8px 24px rgba(0,0,0,.4)}
</style>
</head>
<body>
<div id="toolbar">
  <h1>üèóÔ∏è RISE Agent Architecture</h1>
  <button class="btn btn-green" onclick="openAddModal()">+ Add Node</button>
  <button class="btn btn-amber" onclick="reorganize()">‚ü≥ Reorganize</button>
  <button class="btn btn-blue" onclick="saveState()">üíæ Save</button>
</div>
<div id="canvas"></div>
<div id="tooltip"></div>
<div class="modal-overlay" id="addModal">
  <div class="modal">
    <h2>Add New Node</h2>
    <label>Name</label><input id="f-name" placeholder="e.g. Analytics Bot">
    <label>Type</label><select id="f-type"><option>Agent</option><option>Bot</option></select>
    <label>Team</label><select id="f-team"><option>Operations</option><option>Communications</option><option>HR</option><option>Finance</option><option>Shared Services</option><option>Unassigned</option></select>
    <label>Description</label><textarea id="f-desc" placeholder="What does this node do?"></textarea>
    <label>Phase</label><select id="f-phase"><option>1</option><option>2</option><option>3</option></select>
    <div class="modal-actions">
      <button class="btn btn-red" onclick="closeAddModal()">Cancel</button>
      <button class="btn btn-green" onclick="addNodeFromForm()">Add</button>
    </div>
  </div>
</div>

<script>
const TEAMS={Operations:{color:'#3b82f6',emoji:'üìä',label:'Operations & Reporting'},Communications:{color:'#10b981',emoji:'üìß',label:'Communications & Email'},HR:{color:'#f59e0b',emoji:'üë•',label:'Recruitment & HR'},Finance:{color:'#8b5cf6',emoji:'üí∞',label:'Finance & Analytics'}};
const INITIAL_NODES=[
{id:'courtney',name:'Courtney Gordon',role:'COO / Human in the Loop',type:'Executive',team:'Executive',phase:1,emoji:'üëë',desc:'Chief Operating Officer ‚Äî final decision-maker and authority over all agents.'},
{id:'millie',name:'Millie',role:'Executive AI Agent / Orchestrator',type:'Agent',team:'Orchestrator',phase:1,emoji:'üî∑',desc:'Executive AI agent. Strategic partner. Coordinates all teams and reports to Courtney.'},
{id:'research',name:'Research Agent',role:'Cross-Team Intelligence',type:'Agent',team:'Shared Services',phase:1,emoji:'üîç',desc:'Shared research agent serving all teams with intelligence gathering and synthesis.'},
{id:'ops-lead',name:'Ops Agent',role:'Team Lead',type:'Agent',team:'Operations',phase:1,emoji:'üìä',desc:'Operations team lead ‚Äî manages reporting, compliance, and portfolio workflows.'},
{id:'dlr-bot',name:'DLR Bot',role:'Delinquency Reports',type:'Bot',team:'Operations',phase:1,emoji:'üìã',desc:'Generates and distributes delinquency reports from Entrata data.'},
{id:'ps-bot',name:'Portfolio Scorecard Bot',role:'Portfolio Scoring',type:'Bot',team:'Operations',phase:1,emoji:'üèÜ',desc:'Compiles portfolio-level KPIs into scorecards for leadership review.'},
{id:'wpo-bot',name:'WPO Bot',role:'Weekly Property Ops',type:'Bot',team:'Operations',phase:2,emoji:'üè¢',desc:'Produces weekly property operations summaries across all communities.'},
{id:'compliance-bot',name:'Compliance Bot',role:'Regulatory Tracking',type:'Bot',team:'Operations',phase:2,emoji:'‚úÖ',desc:'Monitors compliance deadlines and regulatory requirements.'},
{id:'comms-lead',name:'Comms Agent',role:'Team Lead',type:'Agent',team:'Communications',phase:1,emoji:'üìß',desc:'Communications team lead ‚Äî manages email triage, auto-replies, calendar, and meetings.'},
{id:'email-bot',name:'Email Triage Bot',role:'Email Sorting',type:'Bot',team:'Communications',phase:1,emoji:'üì•',desc:'Categorizes and prioritizes incoming emails by urgency and topic.'},
{id:'reply-bot',name:'Auto-Reply Bot',role:'Drafts & Replies',type:'Bot',team:'Communications',phase:1,emoji:'‚úçÔ∏è',desc:'Drafts contextual replies for routine email correspondence.'},
{id:'cal-bot',name:'Calendar Bot',role:'Scheduling',type:'Bot',team:'Communications',phase:2,emoji:'üìÖ',desc:'Manages calendar conflicts, scheduling, and availability windows.'},
{id:'meeting-bot',name:'Meeting Prep Bot',role:'Meeting Briefs',type:'Bot',team:'Communications',phase:2,emoji:'üóíÔ∏è',desc:'Prepares agendas, context docs, and follow-up items for meetings.'},
{id:'hr-lead',name:'HR Agent',role:'Team Lead',type:'Agent',team:'HR',phase:2,emoji:'üë•',desc:'HR team lead ‚Äî manages recruitment pipeline, onboarding, and training workflows.'},
{id:'job-bot',name:'Job Posting Bot',role:'Job Distribution',type:'Bot',team:'HR',phase:2,emoji:'üìù',desc:'Creates and distributes job postings across platforms.'},
{id:'resume-bot',name:'Resume Screening Bot',role:'Candidate Filtering',type:'Bot',team:'HR',phase:2,emoji:'üîé',desc:'Screens resumes against role requirements and scores candidates.'},
{id:'onboard-bot',name:'Onboarding Bot',role:'New Hire Setup',type:'Bot',team:'HR',phase:3,emoji:'üéì',desc:'Coordinates onboarding checklists and system access for new hires.'},
{id:'train-bot',name:'Training Bot',role:'Learning & Dev',type:'Bot',team:'HR',phase:3,emoji:'üìö',desc:'Manages training schedules, materials, and completion tracking.'},
{id:'fin-lead',name:'Finance Agent',role:'Team Lead',type:'Agent',team:'Finance',phase:2,emoji:'üí∞',desc:'Finance team lead ‚Äî manages invoicing, budgets, market intel, and NOI reporting.'},
{id:'invoice-bot',name:'Invoice Processing Bot',role:'AP Automation',type:'Bot',team:'Finance',phase:2,emoji:'üßæ',desc:'Processes and routes invoices through approval workflows.'},
{id:'budget-bot',name:'Budget Tracker Bot',role:'Budget Monitoring',type:'Bot',team:'Finance',phase:2,emoji:'üìà',desc:'Tracks budget vs. actuals and flags variances.'},
{id:'market-bot',name:'Market Intel Bot',role:'Market Analysis',type:'Bot',team:'Finance',phase:3,emoji:'üåê',desc:'Gathers market data, comps, and competitive intelligence.'},
{id:'noi-bot',name:'NOI Bot',role:'NOI Reporting',type:'Bot',team:'Finance',phase:3,emoji:'üíµ',desc:'Calculates and reports Net Operating Income across properties.'}
];

let nodes=[], positions={}, canvas, svg, tooltip;

function init(){
  canvas=document.getElementById('canvas');
  tooltip=document.getElementById('tooltip');
  const saved=localStorage.getItem('rise-arch-v2');
  if(saved){try{const s=JSON.parse(saved);nodes=s.nodes;positions=s.positions||{};}catch(e){resetData();}}
  else resetData();
  render();
}
function resetData(){nodes=JSON.parse(JSON.stringify(INITIAL_NODES));positions={};}

function getLayout(){
  const W=Math.max(1200,window.innerWidth-48),cx=W/2;
  const courtY=30,millieY=140,sharedY=250,teamY=360;
  const teamKeys=['Operations','Communications','HR','Finance'];
  const teamGap=24,botsPerRow=2,botH=52,botW=140,pad=20,topPad=48;
  const boxW=(W-teamGap*(teamKeys.length+1))/teamKeys.length;
  const teamBoxes={};
  teamKeys.forEach((t,i)=>{
    const bots=nodes.filter(n=>n.team===t&&n.type==='Bot');
    const leads=nodes.filter(n=>n.team===t&&n.type==='Agent');
    const rows=Math.ceil(Math.max(bots.length,1)/botsPerRow);
    const h=topPad+(leads.length?botH+14:0)+rows*(botH+10)+pad+10;
    teamBoxes[t]={x:teamGap+i*(boxW+teamGap),y:teamY,w:boxW,h:Math.max(h,200)};
  });
  // Default positions
  const def={};
  def['courtney']={x:cx-115,y:courtY,w:230,h:64};
  def['millie']={x:cx-95,y:millieY,w:190,h:60};
  const shared=nodes.filter(n=>n.team==='Shared Services');
  shared.forEach((n,i)=>{def[n.id]={x:cx-80+i*180,y:sharedY+36,w:160,h:52};});
  teamKeys.forEach(t=>{
    const box=teamBoxes[t];
    const leads=nodes.filter(n=>n.team===t&&n.type==='Agent');
    const bots=nodes.filter(n=>n.team===t&&n.type==='Bot');
    leads.forEach(n=>{def[n.id]={x:box.x+(box.w-150)/2,y:box.y+topPad,w:150,h:botH};});
    const startY=box.y+topPad+(leads.length?botH+14:0);
    const bw=(box.w-pad*2-10)/botsPerRow;
    bots.forEach((n,i)=>{
      const col=i%botsPerRow,row=Math.floor(i/botsPerRow);
      def[n.id]={x:box.x+pad+col*(bw+10),y:startY+row*(botH+10),w:bw,h:botH};
    });
  });
  nodes.filter(n=>n.team==='Unassigned').forEach((n,i)=>{
    if(!def[n.id])def[n.id]={x:40+i*170,y:teamY+300,w:150,h:52};
  });
  // Merge saved positions
  const pos={};
  nodes.forEach(n=>{
    if(positions[n.id]){pos[n.id]={...def[n.id],...positions[n.id]};}
    else pos[n.id]=def[n.id]||{x:50,y:600,w:150,h:52};
  });
  const maxBot=Math.max(...teamKeys.map(t=>teamBoxes[t].y+teamBoxes[t].h));
  const infraY=maxBot+40;
  return{W,cx,sharedY,teamY,teamBoxes,pos,infraY,teamGap,barW:W-teamGap*2,teamKeys,def};
}

function render(){
  canvas.innerHTML='';
  svg=document.createElementNS('http://www.w3.org/2000/svg','svg');
  svg.id='lines';svg.style.cssText='position:absolute;top:0;left:0;width:100%;height:100%;pointer-events:none;z-index:1;';
  canvas.appendChild(svg);
  const L=getLayout();
  // Team boxes
  L.teamKeys.forEach(t=>{
    const box=L.teamBoxes[t],info=TEAMS[t],div=document.createElement('div');
    div.className='team-box';
    div.style.cssText=`left:${box.x}px;top:${box.y}px;width:${box.w}px;height:${box.h}px;border-color:${info.color};background:${info.color}11;`;
    div.innerHTML=`<span class="team-label" style="color:${info.color}">${info.emoji} ${info.label}</span>`;
    canvas.appendChild(div);
  });
  // Shared bar
  const sb=document.createElement('div');sb.className='shared-bar';
  sb.style.cssText=`left:${L.teamGap}px;top:${L.sharedY}px;width:${L.barW}px;height:90px;`;
  sb.innerHTML=`<span class="team-label">üîç Shared Services</span>`;
  canvas.appendChild(sb);
  // Infra
  const ib=document.createElement('div');ib.className='infra-bar';
  ib.style.cssText=`left:${L.teamGap}px;top:${L.infraY}px;width:${L.barW}px;`;
  ib.innerHTML=`<span style="font-weight:700;color:#64748b;font-size:12px;margin-right:12px">‚öôÔ∏è Infrastructure</span>`+
    ['Entrata','M365','Egnyte','n8n','Supabase'].map(i=>`<span class="infra-item">${i}</span>`).join('');
  canvas.appendChild(ib);
  // Legend
  const lg=document.createElement('div');lg.id='legend';
  lg.style.cssText=`right:24px;top:${L.sharedY-10}px;`;
  lg.innerHTML=`<h3>Legend</h3>
<div class="legend-item"><span class="legend-swatch" style="background:#f59e0b"></span> Executive (Human)</div>
<div class="legend-item"><span class="legend-swatch" style="background:#3b82f6"></span> Agent (AI Lead)</div>
<div class="legend-item"><span class="legend-swatch" style="background:#475569"></span> Bot (Automated)</div>
<div class="legend-item"><span class="legend-swatch" style="background:#2dd4bf"></span> Shared Services</div>
<div style="margin-top:6px">
<div class="legend-item"><span class="legend-line" style="border-color:#f8fafc"></span> Command Chain</div>
<div class="legend-item"><span class="legend-line" style="border-color:#2dd4bf;border-style:dashed"></span> Shared Service</div></div>
<div style="margin-top:6px">
<div class="legend-item"><span style="background:#475569;color:#f8fafc;font-size:9px;font-weight:700;padding:1px 5px;border-radius:8px">P1</span> Phase 1 ‚Äî Active</div>
<div class="legend-item"><span style="background:#475569;color:#f8fafc;font-size:9px;font-weight:700;padding:1px 5px;border-radius:8px">P2</span> Phase 2 ‚Äî Building</div>
<div class="legend-item"><span style="background:#475569;color:#f8fafc;font-size:9px;font-weight:700;padding:1px 5px;border-radius:8px">P3</span> Phase 3 ‚Äî Planned</div></div>
<div style="margin-top:8px;border-top:1px solid #334155;padding-top:6px;color:#64748b;font-size:10px">
<b>Permission Tiers</b><br>Owner/Exec ‚Üí Regional ‚Üí PM ‚Üí Functional</div>`;
  canvas.appendChild(lg);
  // Nodes
  nodes.forEach(n=>drawNode(n,L));
  canvas.style.minHeight=(L.infraY+80)+'px';
  requestAnimationFrame(()=>drawLines(L));
}

function nodeColor(n){
  if(n.team==='Executive')return{bg:'#92400e',border:'#f59e0b',text:'#fef3c7'};
  if(n.team==='Orchestrator')return{bg:'#1e3a5f',border:'#3b82f6',text:'#dbeafe'};
  if(n.team==='Shared Services')return{bg:'#134e4a',border:'#2dd4bf',text:'#ccfbf1'};
  const t=TEAMS[n.team];
  if(t&&n.type==='Agent')return{bg:t.color+'33',border:t.color,text:'#f8fafc'};
  if(t)return{bg:'#1e293b',border:t.color+'88',text:'#cbd5e1'};
  return{bg:'#1e293b',border:'#475569',text:'#94a3b8'};
}

function drawNode(n,L){
  const p=L.pos[n.id];if(!p)return;
  const c=nodeColor(n),div=document.createElement('div');
  div.className='node';div.dataset.id=n.id;
  div.style.cssText=`left:${p.x}px;top:${p.y}px;width:${p.w}px;height:${p.h}px;background:${c.bg};border:2px solid ${c.border};color:${c.text};`;
  const canDel=n.id!=='courtney'&&n.id!=='millie';
  div.innerHTML=`${canDel?`<button class="delete-btn" onclick="deleteNode('${n.id}')">√ó</button>`:''}<div class="name">${n.emoji} ${n.name}</div><div class="role">${n.role}</div><span class="phase">P${n.phase}</span>`;
  div.addEventListener('mouseenter',e=>{tooltip.style.display='block';tooltip.innerHTML=`<b>${n.emoji} ${n.name}</b><br><span style="color:#94a3b8">${n.type} ¬∑ ${n.team} ¬∑ Phase ${n.phase}</span><br><br>${n.desc}`;tooltip.style.left=(e.clientX+16)+'px';tooltip.style.top=(e.clientY+16)+'px';});
  div.addEventListener('mousemove',e=>{tooltip.style.left=(e.clientX+16)+'px';tooltip.style.top=(e.clientY+16)+'px';});
  div.addEventListener('mouseleave',()=>{tooltip.style.display='none';});
  let ds=null;
  div.addEventListener('pointerdown',e=>{if(e.target.classList.contains('delete-btn'))return;e.preventDefault();div.classList.add('dragging');div.setPointerCapture(e.pointerId);ds={px:e.clientX,py:e.clientY,ox:p.x,oy:p.y};});
  div.addEventListener('pointermove',e=>{if(!ds)return;p.x=ds.ox+(e.clientX-ds.px);p.y=ds.oy+(e.clientY-ds.py);positions[n.id]={x:p.x,y:p.y};div.style.left=p.x+'px';div.style.top=p.y+'px';drawLines(L);});
  div.addEventListener('pointerup',()=>{ds=null;div.classList.remove('dragging');});
  canvas.appendChild(div);
}

function drawLines(L){
  while(svg.firstChild)svg.removeChild(svg.firstChild);
  const pos=L.pos;
  function ctr(id){const p=pos[id];return p?{x:p.x+p.w/2,y:p.y+p.h/2}:null;}
  function ln(a,b,opts={}){
    const pa=pos[a],pb=pos[b];if(!pa||!pb)return;
    const l=document.createElementNS('http://www.w3.org/2000/svg','line');
    l.setAttribute('x1',pa.x+pa.w/2);l.setAttribute('y1',pa.y+pa.h);
    l.setAttribute('x2',pb.x+pb.w/2);l.setAttribute('y2',pb.y);
    l.setAttribute('stroke',opts.color||'#475569');l.setAttribute('stroke-width',opts.w||'2');
    if(opts.dash)l.setAttribute('stroke-dasharray',opts.dash);
    svg.appendChild(l);
  }
  ln('courtney','millie',{color:'#f59e0b',w:'3'});
  const shared=nodes.filter(n=>n.team==='Shared Services');
  shared.forEach(n=>ln('millie',n.id,{color:'#2dd4bf',w:'2'}));
  const leads=nodes.filter(n=>n.type==='Agent'&&Object.keys(TEAMS).includes(n.team));
  leads.forEach(n=>ln('millie',n.id,{color:'#64748b',w:'2'}));
  shared.forEach(s=>{leads.forEach(l=>{ln(s.id,l.id,{color:'#2dd4bf',w:'1',dash:'6,4'});});});
  Object.keys(TEAMS).forEach(t=>{
    const tl=nodes.filter(n=>n.team===t&&n.type==='Agent');
    const bots=nodes.filter(n=>n.team===t&&n.type==='Bot');
    tl.forEach(lead=>{bots.forEach(bot=>{ln(lead.id,bot.id,{color:TEAMS[t].color+'88',w:'1.5'});});});
  });
}

function reorganize(){positions={};render();}
function deleteNode(id){if(id==='courtney'||id==='millie')return;nodes=nodes.filter(n=>n.id!==id);delete positions[id];render();}
function openAddModal(){document.getElementById('addModal').classList.add('open');}
function closeAddModal(){document.getElementById('addModal').classList.remove('open');}
function addNodeFromForm(){
  const name=document.getElementById('f-name').value.trim();if(!name)return;
  const type=document.getElementById('f-type').value,team=document.getElementById('f-team').value;
  const desc=document.getElementById('f-desc').value.trim(),phase=parseInt(document.getElementById('f-phase').value);
  const id=name.toLowerCase().replace(/[^a-z0-9]+/g,'-')+'-'+Date.now();
  nodes.push({id,name,role:type,type,team,phase,emoji:type==='Agent'?'ü§ñ':'‚öôÔ∏è',desc:desc||'No description.'});
  closeAddModal();document.getElementById('f-name').value='';document.getElementById('f-desc').value='';render();
}
function saveState(){
  localStorage.setItem('rise-arch-v2',JSON.stringify({nodes,positions}));
  const b=event.target;b.textContent='‚úÖ Saved!';setTimeout(()=>b.textContent='üíæ Save',1500);
}

window.addEventListener('load',init);
window.addEventListener('resize',()=>render());
</script>
</body>
</html>
