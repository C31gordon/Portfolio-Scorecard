<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>RISE Commission & Bonus Dashboard</title>
<style>
*{box-sizing:border-box;margin:0;padding:0}
:root{--navy:#1B2A4A;--blue:#2E86AB;--green:#28a745;--amber:#ffc107;--red:#dc3545;--bg:#f4f6f9;--card:#fff;--text:#333;--muted:#6c757d;--border:#e0e4e8;--shadow:0 2px 8px rgba(0,0,0,.08);--radius:10px}
body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;background:var(--bg);color:var(--text);line-height:1.5;min-height:100vh}
header{background:var(--navy);color:#fff;padding:12px 24px;display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap;gap:8px}
header h1{font-size:1.3rem;font-weight:700;letter-spacing:.5px}
header .user-info{font-size:.85rem;opacity:.85}
.tabs{background:#fff;border-bottom:2px solid var(--border);display:flex;overflow-x:auto;padding:0 16px}
.tabs button{background:none;border:none;padding:12px 20px;font-size:.9rem;font-weight:600;color:var(--muted);cursor:pointer;border-bottom:3px solid transparent;white-space:nowrap;transition:.2s}
.tabs button:hover{color:var(--navy)}
.tabs button.active{color:var(--navy);border-bottom-color:var(--blue)}
.sub-tabs{background:#f8f9fa;border-bottom:1px solid var(--border);display:flex;overflow-x:auto;padding:0 16px}
.sub-tabs button{background:none;border:none;padding:8px 16px;font-size:.82rem;font-weight:600;color:var(--muted);cursor:pointer;border-bottom:2px solid transparent;white-space:nowrap;transition:.2s}
.sub-tabs button:hover{color:var(--blue)}
.sub-tabs button.active{color:var(--blue);border-bottom-color:var(--blue)}
.tab-content{display:none;padding:20px;max-width:1300px;margin:0 auto}
.tab-content.active{display:block}
.sub-content{display:none}
.sub-content.active{display:block}
.grid{display:grid;gap:16px}
.g2{grid-template-columns:repeat(auto-fit,minmax(280px,1fr))}
.g3{grid-template-columns:repeat(auto-fit,minmax(240px,1fr))}
.g4{grid-template-columns:repeat(auto-fit,minmax(200px,1fr))}
.g5{grid-template-columns:repeat(auto-fit,minmax(160px,1fr))}
.card{background:var(--card);border-radius:var(--radius);box-shadow:var(--shadow);padding:20px;transition:.15s}
.card:hover{box-shadow:0 4px 16px rgba(0,0,0,.12)}
.card h3{font-size:.95rem;color:var(--navy);margin-bottom:12px;display:flex;align-items:center;gap:6px}
.card h3 .icon{font-size:1.1rem}
.stat{font-size:1.8rem;font-weight:700;color:var(--navy)}
.stat-label{font-size:.78rem;color:var(--muted);text-transform:uppercase;letter-spacing:.5px;margin-bottom:4px}
.stat-sub{font-size:.82rem;color:var(--muted);margin-top:2px}
.badge{display:inline-block;padding:2px 10px;border-radius:20px;font-size:.75rem;font-weight:600}
.badge-green{background:#d4edda;color:#155724}
.badge-amber{background:#fff3cd;color:#856404}
.badge-red{background:#f8d7da;color:#721c24}
.badge-blue{background:#d1ecf1;color:#0c5460}
.badge-gray{background:#e9ecef;color:#495057}
table{width:100%;border-collapse:collapse;font-size:.85rem}
th{text-align:left;padding:10px 12px;background:var(--navy);color:#fff;font-weight:600}
td{padding:10px 12px;border-bottom:1px solid var(--border)}
tr:nth-child(even){background:#f8f9fa}
tr:hover{background:#e9ecef}
.section-title{font-size:1.1rem;font-weight:700;color:var(--navy);margin:24px 0 12px;padding-bottom:6px;border-bottom:2px solid var(--blue)}
.section-title:first-child{margin-top:0}
.progress-bar{background:#e9ecef;border-radius:8px;height:10px;overflow:hidden;margin-top:6px}
.progress-fill{height:100%;border-radius:8px;transition:width .5s}
.btn{padding:8px 18px;border:none;border-radius:6px;font-size:.82rem;font-weight:600;cursor:pointer;transition:.15s;display:inline-block}
.btn:hover{opacity:.85}
.btn-green{background:var(--green);color:#fff}
.btn-red{background:var(--red);color:#fff}
.btn-amber{background:var(--amber);color:#333}
.btn-blue{background:var(--blue);color:#fff}
.btn-navy{background:var(--navy);color:#fff}
.btn-outline{background:none;border:2px solid var(--border);color:var(--text)}
.btn-sm{padding:5px 12px;font-size:.78rem}
svg text{font-family:inherit}
.leaderboard-container{margin:8px 0}
.form-group{margin-bottom:14px}
.form-group label{display:block;font-size:.82rem;font-weight:600;color:var(--navy);margin-bottom:4px}
.form-group input,.form-group select,.form-group textarea{width:100%;padding:8px 12px;border:1px solid var(--border);border-radius:6px;font-size:.85rem;font-family:inherit}
.form-group select[multiple]{height:auto}
.chip{display:inline-block;padding:3px 10px;border-radius:14px;font-size:.75rem;background:var(--bg);border:1px solid var(--border);margin:2px}
.flex{display:flex;gap:12px;flex-wrap:wrap;align-items:center}
.ml-auto{margin-left:auto}
.mt{margin-top:16px}
.mb{margin-bottom:16px}
.text-green{color:var(--green)}
.text-red{color:var(--red)}
.text-amber{color:var(--amber)}
.text-muted{color:var(--muted)}
.component-card{border:1px solid var(--border);border-radius:8px;padding:14px;margin-bottom:10px;background:#f8f9fa}
.preview-card{border:2px dashed var(--blue);border-radius:var(--radius);padding:20px;background:#f0f7fa}
.approval-flow{display:flex;align-items:center;gap:4px;flex-wrap:wrap;margin:12px 0;font-size:.82rem}
.flow-step{padding:6px 14px;border-radius:20px;font-weight:600;white-space:nowrap}
.flow-step.done{background:#d4edda;color:#155724}
.flow-step.current{background:#d1ecf1;color:#0c5460;border:2px solid var(--blue)}
.flow-step.pending{background:#e9ecef;color:#6c757d}
.flow-arrow{color:var(--muted);font-weight:700}
.legend{display:flex;gap:16px;flex-wrap:wrap;padding:8px 12px;background:#f8f9fa;border-radius:8px;font-size:.78rem;margin-bottom:12px;align-items:center}
.legend-item{display:flex;align-items:center;gap:5px}
.legend-dot{width:10px;height:10px;border-radius:50%;display:inline-block}
.tooltip-icon{display:inline-flex;align-items:center;justify-content:center;width:16px;height:16px;border-radius:50%;background:var(--blue);color:#fff;font-size:.65rem;font-weight:700;cursor:help;position:relative}
.tooltip-icon:hover::after{content:attr(data-tip);position:absolute;bottom:120%;left:50%;transform:translateX(-50%);background:var(--navy);color:#fff;padding:6px 10px;border-radius:6px;font-size:.75rem;white-space:nowrap;z-index:10;font-weight:400}
.paf-status-flow{display:flex;gap:2px;align-items:center;flex-wrap:wrap;font-size:.72rem;margin:4px 0}
.paf-status-flow span{padding:2px 6px;border-radius:10px}
.paf-inline{border:1px solid var(--border);border-radius:var(--radius);padding:16px;background:#fafbfc;margin-top:12px}
.paf-inline h4{font-size:.9rem;color:var(--navy);margin-bottom:10px}
.paf-inline .paf-grid{display:grid;grid-template-columns:1fr 1fr;gap:8px}
.paf-inline .paf-grid label{font-size:.78rem;font-weight:600;color:var(--muted);text-transform:uppercase;display:block;margin-bottom:2px}
.paf-inline .paf-grid input,.paf-inline .paf-grid select,.paf-inline .paf-grid textarea{width:100%;padding:6px 8px;border:1px solid var(--border);border-radius:4px;font-size:.82rem;font-family:inherit}
.paf-inline .paf-full{grid-column:span 2}
@media(max-width:768px){header{padding:10px 16px}.tabs button{padding:10px 14px;font-size:.82rem}.tab-content{padding:14px}.stat{font-size:1.4rem}.approval-flow{font-size:.72rem}.legend{flex-direction:column;gap:6px}}
</style>
</head>
<body>
<header>
<h1>üìä RISE Commission & Bonus Dashboard</h1>
<div class="user-info">Sarah Mitchell ‚Äî Leasing Agent | The Haven (Conventional) &nbsp;|&nbsp; Feb 2026</div>
</header>
<div class="tabs" id="tabBar">
<button class="active" onclick="showTab('employee')">My Dashboard</button>
<button onclick="showTab('manager')">Manager View</button>
<button onclick="showTab('corp')">Corp. / Finance</button>
<button onclick="showTab('builder')">Structure Builder</button>
</div>

<!-- ============ TAB 1: EMPLOYEE ============ -->
<div class="tab-content active" id="tab-employee">
<div class="section-title">Approval Flow</div>
<div class="card">
<div class="approval-flow">
<span class="flow-step done">‚úì Employee Acknowledges</span><span class="flow-arrow">‚Üí</span>
<span class="flow-step current">‚è≥ Supervisor Approves</span><span class="flow-arrow">‚Üí</span>
<span class="flow-step pending">Senior Approves</span>
</div>
<p style="font-size:.82rem;color:var(--muted)">You must acknowledge your commission/bonus statement before it routes to your supervisor. Manager approves commissions monthly; commissions <strong>and</strong> bonuses at quarter-end.</p>
<div class="mt"><button class="btn btn-green btn-sm" onclick="this.textContent='‚úì Acknowledged';this.disabled=true;this.style.opacity='.6'">‚úÖ Acknowledge My February Statement</button></div>
</div>

<div class="section-title">My Earnings</div>
<div class="grid g3">
<div class="card"><div class="stat-label">Current Month Commission</div><div class="stat">$1,475</div><div class="stat-sub">7 new leases ¬∑ 4 renewals</div><div class="progress-bar"><div class="progress-fill" style="width:68%;background:var(--blue)"></div></div><div class="stat-sub">68% of target ($2,175)</div></div>
<div class="card"><div class="stat-label">QTD Bonus Progress</div><div class="stat text-green">$625</div><div class="stat-sub">Q1 bonus earned so far</div><div class="progress-bar"><div class="progress-fill" style="width:50%;background:var(--green)"></div></div><div class="stat-sub">50% of quarterly target</div></div>
<div class="card"><div class="stat-label">YTD Total Compensation</div><div class="stat">$4,320</div><div class="stat-sub">Commissions: $3,195 ¬∑ Bonuses: $625 ¬∑ Ad Hoc: $500</div></div>
</div>

<div class="section-title">My Activity ‚Äî February 2026</div>
<div class="grid g4">
<div class="card" style="text-align:center"><div class="stat">7</div><div class="stat-label">New Leases</div></div>
<div class="card" style="text-align:center"><div class="stat">4</div><div class="stat-label">Renewals</div></div>
<div class="card" style="text-align:center"><div class="stat">22</div><div class="stat-label">Tours Conducted</div></div>
<div class="card" style="text-align:center"><div class="stat text-green">32%</div><div class="stat-label">Tour-to-Lease</div></div>
</div>

<div class="section-title">Non-Student Leaderboard</div>
<div class="card leaderboard-container" id="empLeaderboard"></div>

<div class="section-title">My Commission Structure</div>
<div class="card">
<div class="flex mb"><span class="badge badge-blue">Conventional</span><span class="chip">Leasing Agent</span><span class="chip">Effective Jan 1 ‚Äì Dec 31, 2026</span></div>
<table><thead><tr><th>Component</th><th>Trigger</th><th>Rate</th><th>Threshold</th><th>Cap</th></tr></thead><tbody>
<tr><td>New Lease Commission</td><td>New Lease Signed</td><td>$100 flat</td><td>‚Äî</td><td>$2,000/mo</td></tr>
<tr><td>Renewal Commission</td><td>Renewal Processed</td><td>$75 flat</td><td>‚Äî</td><td>‚Äî</td></tr>
<tr><td>Tour Bonus</td><td>Tours &gt; 15/month</td><td>$25 per tour over 15</td><td>15 tours minimum</td><td>$250/mo</td></tr>
<tr><td>Q1 Occupancy Bonus</td><td>Occupancy ‚â• 95%</td><td>$500 quarterly</td><td>Avg occupancy ‚â• 95%</td><td>‚Äî</td></tr>
</tbody></table>
<p style="font-size:.78rem;color:var(--muted);margin-top:8px;font-style:italic">üí° Commissions and bonuses are pro-rated for partial periods based on start date.</p>
</div>

<div class="section-title">Payout History</div>
<div class="card" style="overflow-x:auto">
<table><thead><tr><th>Date</th><th>Type</th><th>Amount</th><th>Status</th><th>Pay Period</th></tr></thead><tbody>
<tr><td>Feb 15, 2026</td><td>Monthly Commission</td><td>$1,475</td><td><span class="badge badge-amber">Processing</span></td><td>Feb 1‚Äì15</td></tr>
<tr><td>Jan 31, 2026</td><td>Monthly Commission</td><td>$1,720</td><td><span class="badge badge-green">Paid</span></td><td>Jan 2026</td></tr>
<tr><td>Jan 31, 2026</td><td>Ad Hoc Bonus</td><td>$500</td><td><span class="badge badge-green">Paid</span></td><td>Jan 2026</td></tr>
<tr><td>Dec 31, 2025</td><td>Q4 Bonus</td><td>$1,250</td><td><span class="badge badge-green">Paid</span></td><td>Q4 2025</td></tr>
<tr><td>Dec 31, 2025</td><td>Monthly Commission</td><td>$1,475</td><td><span class="badge badge-green">Paid</span></td><td>Dec 2025</td></tr>
<tr><td>Nov 30, 2025</td><td>Monthly Commission</td><td>$1,350</td><td><span class="badge badge-green">Paid</span></td><td>Nov 2025</td></tr>
</tbody></table>
</div>
</div>

<!-- ============ TAB 2: MANAGER ============ -->
<div class="tab-content" id="tab-manager">
<div class="sub-tabs" id="mgrSubTabs">
<button class="active" onclick="showSubTab('mgr','overview')">Team Overview</button>
<button onclick="showSubTab('mgr','paf')">Personnel Action Forms</button>
</div>

<div class="sub-content active" id="mgr-overview">
<div class="section-title">Approval Flow</div>
<div class="card">
<div class="approval-flow">
<span class="flow-step done">‚úì Employee Acknowledges</span><span class="flow-arrow">‚Üí</span>
<span class="flow-step current">‚è≥ Supervisor Approves</span><span class="flow-arrow">‚Üí</span>
<span class="flow-step pending">Senior Approves</span>
</div>
<p style="font-size:.82rem;color:var(--muted)">Employees must self-acknowledge before their statement reaches you. You approve <strong>commissions monthly</strong> and <strong>commissions + bonuses at quarter-end</strong> (Mar, Jun, Sep, Dec).</p>
</div>

<div class="section-title">Team Overview</div>
<div class="grid g3" id="teamCards"></div>

<div class="section-title">Pending Approvals</div>
<div class="card" style="overflow-x:auto">
<table><thead><tr><th>Employee</th><th>Type</th><th>Amount</th><th>Justification</th><th>Submitted</th><th>Actions</th></tr></thead><tbody>
<tr><td>Marcus Johnson</td><td>Ad Hoc Bonus</td><td>$300</td><td>Covered 2 properties during staff shortage</td><td>Feb 14</td><td><button class="btn btn-green btn-sm" onclick="approveRow(this)">Approve</button> <button class="btn btn-red btn-sm" onclick="denyRow(this)">Deny</button> <button class="btn btn-outline btn-sm" onclick="returnRow(this)">Return</button></td></tr>
<tr><td>Emily Chen</td><td>Commission Adjustment</td><td>$150</td><td>Lease backdated from January</td><td>Feb 12</td><td><button class="btn btn-green btn-sm" onclick="approveRow(this)">Approve</button> <button class="btn btn-red btn-sm" onclick="denyRow(this)">Deny</button> <button class="btn btn-outline btn-sm" onclick="returnRow(this)">Return</button></td></tr>
<tr><td>Tyler Brooks</td><td>Ad Hoc Bonus</td><td>$500</td><td>Resident satisfaction score 4.9/5 for Q4</td><td>Feb 10</td><td><button class="btn btn-green btn-sm" onclick="approveRow(this)">Approve</button> <button class="btn btn-red btn-sm" onclick="denyRow(this)">Deny</button> <button class="btn btn-outline btn-sm" onclick="returnRow(this)">Return</button></td></tr>
</tbody></table>
</div>

<div class="section-title">Team Leaderboard</div>
<div class="card" id="teamLeaderboard"></div>

<div class="section-title" style="display:flex;align-items:center;gap:8px">Payout Summary ‚Äî February 2026 <span class="tooltip-icon" data-tip="On Track ‚â•80% | At Risk 50-79% | Behind <50% of quarterly goal">?</span></div>
<div class="legend">
<strong>Status Legend:</strong>
<span class="legend-item"><span class="legend-dot" style="background:var(--green)"></span> <strong>On Track</strong> ‚Äî Pace ‚â•80% of quarterly bonus goal</span>
<span class="legend-item"><span class="legend-dot" style="background:var(--amber)"></span> <strong>At Risk</strong> ‚Äî Pace 50‚Äì79% of goal</span>
<span class="legend-item"><span class="legend-dot" style="background:var(--red)"></span> <strong>Behind</strong> ‚Äî Pace &lt;50% of goal</span>
</div>
<div class="card" style="overflow-x:auto">
<table><thead><tr><th>Team Member</th><th>MTD Commission</th><th>QTD Bonus</th><th>Q1 Projection</th><th>Status</th><th>Acknowledged</th></tr></thead><tbody>
<tr><td>Sarah Mitchell</td><td>$1,475</td><td>$625</td><td>$1,250</td><td><span class="badge badge-green">On Track</span></td><td><span class="badge badge-green">‚úì Yes</span></td></tr>
<tr><td>Marcus Johnson</td><td>$1,200</td><td>$400</td><td>$800</td><td><span class="badge badge-amber">At Risk</span></td><td><span class="badge badge-amber">Pending</span></td></tr>
<tr><td>Emily Chen</td><td>$1,650</td><td>$750</td><td>$1,500</td><td><span class="badge badge-green">On Track</span></td><td><span class="badge badge-green">‚úì Yes</span></td></tr>
<tr><td>Tyler Brooks</td><td>$950</td><td>$300</td><td>$600</td><td><span class="badge badge-red">Behind</span></td><td><span class="badge badge-green">‚úì Yes</span></td></tr>
<tr><td>Aisha Patel</td><td>$1,375</td><td>$550</td><td>$1,100</td><td><span class="badge badge-green">On Track</span></td><td><span class="badge badge-green">‚úì Yes</span></td></tr>
<tr><td>Jordan Rivera</td><td>$800</td><td>$200</td><td>$400</td><td><span class="badge badge-red">Behind</span></td><td><span class="badge badge-amber">Pending</span></td></tr>
</tbody></table>
</div>
</div>

<!-- Manager PAF Sub-tab -->
<div class="sub-content" id="mgr-paf">
<div class="section-title">Personnel Action Forms</div>
<div class="flex mb">
<button class="btn btn-blue" onclick="document.getElementById('mgrPafForm').style.display=document.getElementById('mgrPafForm').style.display==='none'?'block':'none'">+ Quick-Create PAF</button>
<span class="text-muted" style="font-size:.82rem">Approved PAF amounts automatically feed into the Payout Summary totals.</span>
</div>

<div class="card" style="overflow-x:auto">
<div class="mb" style="font-size:.82rem;color:var(--muted)">PAF Status Flow: <strong>Draft ‚Üí Employee Acknowledged ‚Üí Supervisor Approved ‚Üí Senior Approved ‚Üí Submitted to PayCorp ‚Üí Confirmed</strong></div>
<table><thead><tr><th>Form No.</th><th>Employee</th><th>Type</th><th>Amount</th><th>Submitted</th><th>Status</th></tr></thead><tbody>
<tr><td>PAF-2026-0218</td><td>Maria Santos</td><td>Leasing Commission</td><td>$450</td><td>Feb 18</td><td><span class="badge badge-green">Senior Approved</span></td></tr>
<tr><td>PAF-2026-0215</td><td>Marcus Johnson</td><td>Ad Hoc Bonus</td><td>$300</td><td>Feb 15</td><td><span class="badge badge-blue">Supervisor Approved</span></td></tr>
<tr><td>PAF-2026-0212</td><td>Emily Chen</td><td>Commission Adjustment</td><td>$150</td><td>Feb 12</td><td><span class="badge badge-amber">Employee Acknowledged</span></td></tr>
<tr><td>PAF-2026-0210</td><td>Tyler Brooks</td><td>Performance Bonus</td><td>$500</td><td>Feb 10</td><td><span class="badge badge-gray">Draft</span></td></tr>
</tbody></table>
</div>

<!-- Inline PAF Form -->
<div id="mgrPafForm" class="paf-inline" style="display:none">
<h4>üìã New Personnel Action Form ‚Äî One-Time Commission Payout</h4>
<div class="paf-grid">
<div><label>Employee Name</label><input type="text" placeholder="Full name"></div>
<div><label>Employee ID</label><input type="text" placeholder="RSE-XXXXX"></div>
<div><label>Title / Position</label>
<select><option value="">Select title‚Ä¶</option><option>Assistant Manager</option><option>Leasing Agent</option><option>Leasing Manager</option><option>Maintenance Supervisor</option><option>Maintenance Tech</option><option>Property Manager</option><option>Regional Director</option></select></div>
<div><label>Property Assigned</label><input type="text" placeholder="e.g., RISE Bartram Park"></div>
<div><label>Property Type</label>
<select><option>Conventional</option><option>Student Off-Campus</option><option>Student On-Campus</option><option>55+</option><option>BTR</option></select></div>
<div><label>Payout Type</label>
<select><option>Leasing Commission</option><option>Renewal Commission</option><option>Lease-Up Bonus</option><option>Performance Bonus</option><option>Referral Bonus</option><option>Ad Hoc Bonus</option><option>Other</option></select></div>
<div><label>Amount ($)</label><input type="text" placeholder="$0.00"></div>
<div><label>Pay Period</label><input type="text" placeholder="e.g., Feb 16‚Äì28, 2026"></div>
<div class="paf-full"><label>Calculation Basis</label><input type="text" placeholder="e.g., 3 new leases √ó $150 = $450"></div>
<div class="paf-full"><label>Justification / Notes</label><textarea rows="2" placeholder="Explain the payout‚Ä¶"></textarea></div>
<div><label>Supervisor Name</label><input type="text"></div>
<div><label>Date Submitted</label><input type="date"></div>
</div>
<div class="flex mt">
<button class="btn btn-outline btn-sm" onclick="alert('Saved as draft')">Save Draft</button>
<button class="btn btn-navy btn-sm" onclick="alert('Submitted for employee acknowledgment')">Submit PAF</button>
</div>
</div>
</div>
</div>

<!-- ============ TAB 3: CORP./FINANCE ============ -->
<div class="tab-content" id="tab-corp">
<div class="sub-tabs" id="corpSubTabs">
<button class="active" onclick="showSubTab('corp','portfolio')">Portfolio Summary</button>
<button onclick="showSubTab('corp','paf')">Personnel Action Forms</button>
</div>

<div class="sub-content active" id="corp-portfolio">
<div class="section-title">Portfolio Summary</div>
<div class="grid g4">
<div class="card"><div class="stat-label">MTD Commission Expense</div><div class="stat">$87,450</div><div class="stat-sub">Feb 2026</div></div>
<div class="card"><div class="stat-label">QTD Commission Expense</div><div class="stat">$198,720</div><div class="stat-sub">Q1 2026</div></div>
<div class="card"><div class="stat-label">YTD Total Comp Expense</div><div class="stat">$198,720</div><div class="stat-sub">Jan ‚Äì Feb 2026</div></div>
<div class="card"><div class="stat-label">Pending Payouts</div><div class="stat text-amber">$23,150</div><div class="stat-sub">14 submissions awaiting approval</div></div>
</div>
<div class="grid g5 mt">
<div class="card"><div class="stat-label">Conventional</div><div class="stat" style="font-size:1.3rem">$42,300</div><div class="progress-bar"><div class="progress-fill" style="width:48%;background:var(--blue)"></div></div></div>
<div class="card"><div class="stat-label">Student Off-Campus</div><div class="stat" style="font-size:1.3rem">$17,200</div><div class="progress-bar"><div class="progress-fill" style="width:20%;background:var(--green)"></div></div></div>
<div class="card"><div class="stat-label">Student On-Campus</div><div class="stat" style="font-size:1.3rem">$11,400</div><div class="progress-bar"><div class="progress-fill" style="width:13%;background:#20c997"></div></div></div>
<div class="card"><div class="stat-label">55+</div><div class="stat" style="font-size:1.3rem">$9,250</div><div class="progress-bar"><div class="progress-fill" style="width:11%;background:var(--amber)"></div></div></div>
<div class="card"><div class="stat-label">Build-to-Rent</div><div class="stat" style="font-size:1.3rem">$7,300</div><div class="progress-bar"><div class="progress-fill" style="width:8%;background:var(--navy)"></div></div></div>
</div>

<div class="section-title">Commission Structures (Active Plans)</div>
<div class="grid g2" id="structureCards"></div>

<div class="section-title">PayCorp Integration Status</div>
<div class="card">
<div class="flex mb">
<span class="badge badge-green" style="font-size:.85rem">‚óè Connected</span>
<span class="text-muted" style="font-size:.85rem">paycorp.com API v2.4</span>
<span class="ml-auto text-muted" style="font-size:.82rem">Last sync: Feb 18, 2026 at 6:00 AM EST</span>
</div>
<table><thead><tr><th>Metric</th><th>Value</th><th>Status</th></tr></thead><tbody>
<tr><td>Employee Records Synced</td><td>342 / 342</td><td><span class="badge badge-green">Complete</span></td></tr>
<tr><td>Pending Commission Submissions</td><td>14 payouts ($23,150)</td><td><span class="badge badge-amber">Awaiting Approval</span></td></tr>
<tr><td>Last Successful Payout File</td><td>Jan 31, 2026 ‚Äî 287 records</td><td><span class="badge badge-green">Confirmed</span></td></tr>
<tr><td>Next Scheduled Sync</td><td>Feb 19, 2026 at 6:00 AM</td><td><span class="badge badge-blue">Scheduled</span></td></tr>
<tr><td>API Health</td><td>99.8% uptime (30d)</td><td><span class="badge badge-green">Healthy</span></td></tr>
</tbody></table>
</div>

<div class="section-title">Audit Log</div>
<div class="card" style="overflow-x:auto">
<table><thead><tr><th>Timestamp</th><th>User</th><th>Action</th><th>Detail</th></tr></thead><tbody>
<tr><td>Feb 18, 10:32 AM</td><td>C. Gordon</td><td>Structure Updated</td><td>Modified "Conventional Leasing Agent" ‚Äî increased renewal rate $50‚Üí$75</td></tr>
<tr><td>Feb 17, 4:15 PM</td><td>J. Martinez</td><td>PAF Approved</td><td>Ad hoc bonus $300 for Marcus Johnson ‚Äî Level 2 approval</td></tr>
<tr><td>Feb 17, 2:00 PM</td><td>R. Thompson</td><td>PAF Submitted</td><td>Ad hoc bonus $300 for Marcus Johnson ‚Äî staff shortage coverage</td></tr>
<tr><td>Feb 16, 11:20 AM</td><td>C. Gordon</td><td>Structure Created</td><td>New plan "BTR Leasing Specialist" ‚Äî 3 components</td></tr>
<tr><td>Feb 15, 9:00 AM</td><td>System</td><td>Payout Generated</td><td>Feb mid-month commission file ‚Äî 156 records, $43,200</td></tr>
<tr><td>Feb 14, 3:45 PM</td><td>C. Gordon</td><td>Structure Updated</td><td>Modified "Student Off-Campus Leasing Agent" ‚Äî added pre-lease milestone</td></tr>
<tr><td>Feb 13, 10:00 AM</td><td>System</td><td>PayCorp Sync</td><td>12 new hires synced, 3 terminations processed</td></tr>
</tbody></table>
</div>
</div>

<!-- Corp./Finance PAF Sub-tab -->
<div class="sub-content" id="corp-paf">
<div class="section-title">Personnel Action Forms ‚Äî Portfolio-Wide</div>
<div class="grid g3 mb">
<div class="card"><div class="stat-label">PAF Payouts MTD</div><div class="stat">$4,850</div><div class="stat-sub">8 confirmed PAFs ‚Äî Feb 2026</div></div>
<div class="card"><div class="stat-label">PAF Payouts QTD</div><div class="stat">$12,300</div><div class="stat-sub">22 confirmed PAFs ‚Äî Q1 2026</div></div>
<div class="card"><div class="stat-label">PAF Payouts YTD</div><div class="stat">$12,300</div><div class="stat-sub">22 confirmed PAFs ‚Äî 2026</div></div>
</div>
<p style="font-size:.82rem;color:var(--muted);margin-bottom:12px">These totals feed into the overall commission/bonus budget numbers shown in Portfolio Summary.</p>

<div class="card mb">
<div class="flex mb">
<div class="form-group" style="margin:0;min-width:140px"><label style="margin:0;font-size:.75rem">Property</label><select style="padding:5px 8px;font-size:.8rem"><option>All Properties</option><option>The Haven</option><option>Riverside Terrace</option><option>Parkview Landing</option><option>Campus Edge</option><option>University Commons</option></select></div>
<div class="form-group" style="margin:0;min-width:140px"><label style="margin:0;font-size:.75rem">Status</label><select style="padding:5px 8px;font-size:.8rem"><option>All Statuses</option><option>Draft</option><option>Employee Acknowledged</option><option>Supervisor Approved</option><option>Senior Approved</option><option>Submitted to PayCorp</option><option>Confirmed</option></select></div>
<div class="form-group" style="margin:0;min-width:120px"><label style="margin:0;font-size:.75rem">From</label><input type="date" value="2026-01-01" style="padding:5px 8px;font-size:.8rem"></div>
<div class="form-group" style="margin:0;min-width:120px"><label style="margin:0;font-size:.75rem">To</label><input type="date" value="2026-02-28" style="padding:5px 8px;font-size:.8rem"></div>
<button class="btn btn-blue btn-sm" style="align-self:flex-end" onclick="alert('Filters applied')">Filter</button>
<button class="btn btn-outline btn-sm" style="align-self:flex-end" onclick="alert('Exporting CSV‚Ä¶')">üì• Export</button>
</div>
<table><thead><tr><th>Form No.</th><th>Property</th><th>Employee</th><th>Type</th><th>Amount</th><th>Submitted</th><th>Status</th></tr></thead><tbody>
<tr><td>PAF-2026-0218</td><td>RISE Bartram Park</td><td>Maria Santos</td><td>Leasing Commission</td><td>$450</td><td>Feb 18</td><td><span class="badge badge-green">Confirmed</span></td></tr>
<tr><td>PAF-2026-0216</td><td>The Haven</td><td>Sarah Mitchell</td><td>Renewal Commission</td><td>$300</td><td>Feb 16</td><td><span class="badge badge-blue">Submitted to PayCorp</span></td></tr>
<tr><td>PAF-2026-0215</td><td>The Haven</td><td>Marcus Johnson</td><td>Ad Hoc Bonus</td><td>$300</td><td>Feb 15</td><td><span class="badge badge-blue">Supervisor Approved</span></td></tr>
<tr><td>PAF-2026-0212</td><td>Riverside Terrace</td><td>Emily Chen</td><td>Commission Adjustment</td><td>$150</td><td>Feb 12</td><td><span class="badge badge-amber">Employee Acknowledged</span></td></tr>
<tr><td>PAF-2026-0210</td><td>The Haven</td><td>Tyler Brooks</td><td>Performance Bonus</td><td>$500</td><td>Feb 10</td><td><span class="badge badge-gray">Draft</span></td></tr>
<tr><td>PAF-2026-0205</td><td>Campus Edge</td><td>Danielle Foster</td><td>Lease-Up Bonus</td><td>$750</td><td>Feb 5</td><td><span class="badge badge-green">Confirmed</span></td></tr>
<tr><td>PAF-2026-0131</td><td>University Commons</td><td>Chris Ramirez</td><td>Performance Bonus</td><td>$400</td><td>Jan 31</td><td><span class="badge badge-green">Confirmed</span></td></tr>
<tr><td>PAF-2026-0128</td><td>Parkview Landing</td><td>Aisha Patel</td><td>Leasing Commission</td><td>$600</td><td>Jan 28</td><td><span class="badge badge-green">Confirmed</span></td></tr>
</tbody></table>
</div>
</div>
</div>

<!-- ============ TAB 4: BUILDER ============ -->
<div class="tab-content" id="tab-builder">
<div class="section-title">Commission Structure Builder</div>
<div class="grid g2">
<div>
<div class="card">
<h3><span class="icon">üèóÔ∏è</span> Plan Details</h3>
<div class="form-group"><label>Plan Name</label><input type="text" id="planName" placeholder="e.g., BTR Leasing Specialist" value="BTR Leasing Specialist" oninput="updatePreview()"></div>
<div class="form-group"><label>Property Type(s)</label><select multiple id="planPropType" size="5" onchange="updatePreview()"><option selected>Build-to-Rent (BTR)</option><option>Conventional</option><option>Student Off-Campus</option><option>Student On-Campus</option><option>55+</option></select></div>
<div class="form-group"><label>Applicable Title</label><select id="planTitle" onchange="updateTitlePreview()"><option value="">Select title‚Ä¶</option><option>Assistant Manager</option><option>Leasing Agent</option><option>Leasing Manager</option><option>Maintenance Supervisor</option><option>Maintenance Tech</option><option>Property Manager</option><option>Regional Director</option></select></div>
<div class="form-group"><label>Employee Start Date <span class="tooltip-icon" data-tip="Commissions and bonuses are pro-rated for partial periods based on start date">?</span></label><input type="date" id="planStartDate" value="2026-02-10" onchange="updateProration()"></div>
<div class="form-group"><label>Effective Start</label><input type="date" id="planStart" value="2026-03-01" onchange="updatePreview()"></div>
<div class="form-group"><label>Effective End</label><input type="date" id="planEnd" value="2026-12-31" onchange="updatePreview()"></div>
<div id="prorationNote" class="mt" style="font-size:.82rem;padding:8px 12px;background:#fff3cd;border-radius:6px;display:none">
<strong>‚ö° Pro-ration:</strong> <span id="prorationText"></span>
</div>
</div>
<div class="card mt">
<h3><span class="icon">‚öôÔ∏è</span> Commission Components</h3>
<div id="componentsList">
<div class="component-card">
<div class="flex mb"><strong style="font-size:.85rem">Component 1: New Lease</strong><button class="btn btn-outline btn-sm ml-auto" onclick="this.closest('.component-card').remove();updatePreview()">‚úï</button></div>
<div class="grid g2">
<div class="form-group"><label>Trigger</label><select onchange="updatePreview()"><option selected>New Lease</option><option>Renewal</option><option>Tour Milestone</option><option>Occupancy Target</option><option>NOI Target</option><option>WO SLA</option><option>Attendance</option><option>Custom</option></select></div>
<div class="form-group"><label>Rate Type</label><select onchange="updatePreview()"><option selected>Flat $</option><option>Per-unit $</option><option>% of Rent</option><option>% of NOI</option></select></div>
<div class="form-group"><label>Amount</label><input type="text" value="$150" oninput="updatePreview()"></div>
<div class="form-group"><label>Threshold</label><input type="text" value="‚Äî" oninput="updatePreview()"></div>
<div class="form-group"><label>Cap</label><input type="text" value="$2,500/mo" oninput="updatePreview()"></div>
</div>
</div>
<div class="component-card">
<div class="flex mb"><strong style="font-size:.85rem">Component 2: Renewal</strong><button class="btn btn-outline btn-sm ml-auto" onclick="this.closest('.component-card').remove();updatePreview()">‚úï</button></div>
<div class="grid g2">
<div class="form-group"><label>Trigger</label><select onchange="updatePreview()"><option>New Lease</option><option selected>Renewal</option><option>Tour Milestone</option><option>Occupancy Target</option><option>NOI Target</option><option>WO SLA</option><option>Attendance</option><option>Custom</option></select></div>
<div class="form-group"><label>Rate Type</label><select onchange="updatePreview()"><option selected>Flat $</option><option>Per-unit $</option><option>% of Rent</option><option>% of NOI</option></select></div>
<div class="form-group"><label>Amount</label><input type="text" value="$100" oninput="updatePreview()"></div>
<div class="form-group"><label>Threshold</label><input type="text" value="‚Äî" oninput="updatePreview()"></div>
<div class="form-group"><label>Cap</label><input type="text" value="‚Äî" oninput="updatePreview()"></div>
</div>
</div>
</div>
<button class="btn btn-blue mt" onclick="addComponent()">+ Add Component</button>
</div>
</div>
<div>
<div class="card preview-card">
<h3><span class="icon">üëÅÔ∏è</span> Live Preview</h3>
<div id="previewContent"></div>
</div>
<div class="flex mt" style="justify-content:flex-end">
<button class="btn btn-outline" onclick="alert('Draft saved!')">Save as Draft</button>
<button class="btn btn-navy" onclick="alert('Submitted for approval!')">Submit for Approval</button>
</div>
</div>
</div>
</div>

<script>
const TAB_IDS=['employee','manager','corp','builder'];
function showTab(id){
document.querySelectorAll('.tab-content').forEach(t=>t.classList.remove('active'));
document.querySelectorAll('#tabBar button').forEach(b=>b.classList.remove('active'));
document.getElementById('tab-'+id).classList.add('active');
document.querySelectorAll('#tabBar button').forEach((b,i)=>{if(TAB_IDS[i]===id)b.classList.add('active')});
if(id==='employee'||id==='manager')resizeLeaderboards();
}
function showSubTab(prefix,name){
const parent=document.getElementById('tab-'+prefix);
parent.querySelectorAll('.sub-content').forEach(s=>s.classList.remove('active'));
parent.querySelectorAll('.sub-tabs button').forEach(b=>b.classList.remove('active'));
document.getElementById(prefix+'-'+name).classList.add('active');
event.target.classList.add('active');
}

// SVG Leaderboard (name + bar, no numbers)
function renderLeaderboard(el,data,highlightName){
if(!el)return;
const maxVal=Math.max(...data.map(d=>d.val));
const barH=22,gap=6,pad=130,w=el.clientWidth||500,h=data.length*(barH+gap)+10;
let svg=`<svg width="100%" height="${h}" viewBox="0 0 ${w} ${h}" xmlns="http://www.w3.org/2000/svg">`;
data.forEach((d,i)=>{
const y=i*(barH+gap)+4;
const bw=Math.max(4,((d.val/maxVal)*(w-pad-20)));
const isHL=d.name===highlightName;
const color=isHL?'#2E86AB':'#1B2A4A';
const fw=isHL?'700':'400';
svg+=`<text x="4" y="${y+barH-6}" font-size="13" fill="#333" font-weight="${fw}">${d.name}</text>`;
svg+=`<rect x="${pad}" y="${y}" width="${bw}" height="${barH}" rx="4" fill="${color}" opacity="${isHL?1:.7}"/>`;
});
svg+=`</svg>`;
el.innerHTML=svg;
}

// Leaderboard data ‚Äî Non-student
const nonStudentLB=[
{name:'Emily Chen',val:95},{name:'Sarah Mitchell',val:82},{name:'Aisha Patel',val:78},
{name:'Marcus Johnson',val:72},{name:'Danielle Foster',val:68},{name:'Chris Ramirez',val:63},
{name:'Tyler Brooks',val:55},{name:'Jordan Rivera',val:48},{name:'Kayla Nguyen',val:44},
{name:'Brandon Wells',val:38}
];
// Student Off-Campus
const studentOffCampusLB=[
{name:'Mia Rodriguez',val:88},{name:'Jake Thompson',val:80},{name:'Nina Patel',val:74},
{name:'Derek Collins',val:65},{name:'Samantha Lee',val:58},{name:'Ryan Murphy',val:50}
];
// Student On-Campus
const studentOnCampusLB=[
{name:'Ashley Williams',val:90},{name:'Trevor Nguyen',val:78},{name:'Jasmine Scott',val:72},
{name:'Kyle Martinez',val:64},{name:'Brianna Taylor',val:56},{name:'Omar Davis',val:45}
];

const teamLBData=[
{name:'Emily Chen',val:95},{name:'Sarah Mitchell',val:82},{name:'Aisha Patel',val:78},
{name:'Marcus Johnson',val:72},{name:'Tyler Brooks',val:55},{name:'Jordan Rivera',val:48}
];

// Team cards
const teamMembers=[
{name:'Sarah Mitchell',title:'Leasing Agent',prop:'The Haven',type:'Conventional',mtd:'$1,475',qtd:'$625',status:'green',statusText:'On Track'},
{name:'Marcus Johnson',title:'Leasing Agent',prop:'The Haven',type:'Conventional',mtd:'$1,200',qtd:'$400',status:'amber',statusText:'At Risk'},
{name:'Emily Chen',title:'Leasing Manager',prop:'Riverside Terrace',type:'Conventional',mtd:'$1,650',qtd:'$750',status:'green',statusText:'On Track'},
{name:'Tyler Brooks',title:'Leasing Agent',prop:'The Haven',type:'Conventional',mtd:'$950',qtd:'$300',status:'red',statusText:'Behind'},
{name:'Aisha Patel',title:'Leasing Agent',prop:'Parkview Landing',type:'55+',mtd:'$1,375',qtd:'$550',status:'green',statusText:'On Track'},
{name:'Jordan Rivera',title:'Leasing Agent',prop:'Parkview Landing',type:'BTR',mtd:'$800',qtd:'$200',status:'red',statusText:'Behind'}
];

function renderTeamCards(){
document.getElementById('teamCards').innerHTML=teamMembers.map(m=>`<div class="card">
<div class="flex mb"><strong>${m.name}</strong><span class="badge badge-${m.status}" style="margin-left:auto">${m.statusText}</span></div>
<div class="text-muted" style="font-size:.82rem">${m.title} ¬∑ ${m.prop} <span class="chip">${m.type}</span></div>
<div class="grid g2 mt" style="gap:8px">
<div><div class="stat-label">MTD Commission</div><div style="font-weight:700">${m.mtd}</div></div>
<div><div class="stat-label">QTD Bonus</div><div style="font-weight:700">${m.qtd}</div></div>
</div></div>`).join('');
}

// Structure cards
const structures=[
{name:'Conventional Leasing Agent',types:['Conventional'],components:'$100/new lease ¬∑ $75/renewal ¬∑ $25/tour (>15/mo)',color:'var(--blue)'},
{name:'Student Off-Campus Leasing Agent',types:['Student Off-Campus'],components:'$50/bed leased ¬∑ $500 pre-lease milestone (>90% by March)',color:'var(--green)'},
{name:'Student On-Campus Leasing Agent',types:['Student On-Campus'],components:'$50/bed leased ¬∑ $400 pre-lease milestone (>85% by April)',color:'#20c997'},
{name:'Community Manager Bonus',types:['All'],components:'Quarterly NOI bonus: 2% of NOI above target',color:'var(--navy)'},
{name:'Maintenance Supervisor',types:['All'],components:'$200/month if WO SLA >95%',color:'var(--amber)'},
{name:'55+ Leasing Specialist',types:['55+'],components:'$125/new lease ¬∑ $100/renewal ¬∑ $50 referral',color:'var(--red)'}
];
function renderStructures(){
document.getElementById('structureCards').innerHTML=structures.map(s=>`<div class="card" style="border-left:4px solid ${s.color}">
<h3>${s.name}</h3>
<div class="mb">${s.types.map(t=>`<span class="chip">${t}</span>`).join('')}</div>
<div style="font-size:.85rem;color:var(--muted)">${s.components}</div></div>`).join('');
}

// Title-based structure preview
const titleStructures={
'Assistant Manager':{components:[
{trigger:'New Lease',rate:'Flat $',amount:'$75',threshold:'‚Äî',cap:'$1,500/mo'},
{trigger:'Renewal',rate:'Flat $',amount:'$50',threshold:'‚Äî',cap:'‚Äî'},
{trigger:'Occupancy Target',rate:'Quarterly',amount:'$500',threshold:'Occupancy >95%',cap:'‚Äî'}
]},
'Leasing Agent':{components:[
{trigger:'New Lease',rate:'Flat $',amount:'$100',threshold:'‚Äî',cap:'$2,000/mo'},
{trigger:'Renewal',rate:'Flat $',amount:'$75',threshold:'‚Äî',cap:'‚Äî'},
{trigger:'Tour Milestone',rate:'Per tour over 15',amount:'$25',threshold:'>15 tours/month',cap:'$250/mo'}
]},
'Leasing Manager':{components:[
{trigger:'New Lease',rate:'Flat $',amount:'$125',threshold:'‚Äî',cap:'$2,500/mo'},
{trigger:'Renewal',rate:'Flat $',amount:'$100',threshold:'‚Äî',cap:'‚Äî'},
{trigger:'Occupancy Target',rate:'Quarterly',amount:'$750',threshold:'Team >93% leased',cap:'‚Äî'}
]},
'Maintenance Supervisor':{components:[
{trigger:'WO SLA',rate:'Monthly',amount:'$200',threshold:'WO SLA >95%',cap:'‚Äî'},
{trigger:'Custom',rate:'Quarterly',amount:'$300',threshold:'Resident satisfaction >4.5',cap:'‚Äî'}
]},
'Maintenance Tech':{components:[
{trigger:'Attendance',rate:'Monthly',amount:'$50',threshold:'Perfect attendance',cap:'‚Äî'},
{trigger:'Custom',rate:'Quarterly',amount:'$100',threshold:'Zero callbacks',cap:'‚Äî'}
]},
'Property Manager':{components:[
{trigger:'NOI Target',rate:'% of NOI',amount:'1% of NOI above target',threshold:'Quarterly',cap:'‚Äî'},
{trigger:'Occupancy Target',rate:'Monthly',amount:'$200',threshold:'Occupancy >95%',cap:'‚Äî'}
]},
'Regional Director':{components:[
{trigger:'NOI Target',rate:'% of Portfolio NOI',amount:'0.5% of portfolio NOI above target',threshold:'Quarterly',cap:'‚Äî'},
{trigger:'Custom',rate:'Annual',amount:'Performance bonus (TBD)',threshold:'Annual review',cap:'‚Äî'}
]}
};

function updateTitlePreview(){
const title=document.getElementById('planTitle').value;
if(title&&titleStructures[title]){
// Populate components list from title
const list=document.getElementById('componentsList');
list.innerHTML='';
titleStructures[title].components.forEach((c,i)=>{
const div=document.createElement('div');
div.className='component-card';
div.innerHTML=`<div class="flex mb"><strong style="font-size:.85rem">Component ${i+1}: ${c.trigger}</strong><button class="btn btn-outline btn-sm ml-auto" onclick="this.closest('.component-card').remove();updatePreview()">‚úï</button></div>
<div class="grid g2">
<div class="form-group"><label>Trigger</label><select onchange="updatePreview()"><option ${c.trigger==='New Lease'?'selected':''}>New Lease</option><option ${c.trigger==='Renewal'?'selected':''}>Renewal</option><option ${c.trigger==='Tour Milestone'?'selected':''}>Tour Milestone</option><option ${c.trigger==='Occupancy Target'?'selected':''}>Occupancy Target</option><option ${c.trigger==='NOI Target'?'selected':''}>NOI Target</option><option ${c.trigger==='WO SLA'?'selected':''}>WO SLA</option><option ${c.trigger==='Attendance'?'selected':''}>Attendance</option><option ${c.trigger==='Custom'?'selected':''}>Custom</option></select></div>
<div class="form-group"><label>Rate Type</label><select onchange="updatePreview()"><option ${c.rate.startsWith('Flat')?'selected':''}>Flat $</option><option ${c.rate==='Per-unit $'||c.rate.startsWith('Per')?'selected':''}>Per-unit $</option><option ${c.rate==='% of Rent'?'selected':''}>% of Rent</option><option ${c.rate.includes('NOI')?'selected':''}>% of NOI</option><option ${c.rate==='Monthly'?'selected':''}>Monthly</option><option ${c.rate==='Quarterly'?'selected':''}>Quarterly</option><option ${c.rate==='Annual'?'selected':''}>Annual</option></select></div>
<div class="form-group"><label>Amount</label><input type="text" value="${c.amount}" oninput="updatePreview()"></div>
<div class="form-group"><label>Threshold</label><input type="text" value="${c.threshold}" oninput="updatePreview()"></div>
<div class="form-group"><label>Cap</label><input type="text" value="${c.cap}" oninput="updatePreview()"></div>
</div>`;
list.appendChild(div);
});
compCount=titleStructures[title].components.length;
}
updatePreview();
}

// Pro-ration
function updateProration(){
const sd=document.getElementById('planStartDate').value;
if(!sd)return document.getElementById('prorationNote').style.display='none';
const d=new Date(sd);
const dayOfMonth=d.getDate();
const daysInMonth=new Date(d.getFullYear(),d.getMonth()+1,0).getDate();
const daysWorked=daysInMonth-dayOfMonth+1;
const ratio=(daysWorked/daysInMonth*100).toFixed(1);
document.getElementById('prorationNote').style.display='block';
document.getElementById('prorationText').innerHTML=`Start date ${sd} ‚Üí ${daysWorked}/${daysInMonth} days = <strong>${ratio}%</strong> of monthly targets. Quarterly bonuses pro-rated similarly.`;
updatePreview();
}

let compCount=2;
function addComponent(){
compCount++;
const div=document.createElement('div');
div.className='component-card';
div.innerHTML=`<div class="flex mb"><strong style="font-size:.85rem">Component ${compCount}</strong><button class="btn btn-outline btn-sm ml-auto" onclick="this.closest('.component-card').remove();updatePreview()">‚úï</button></div>
<div class="grid g2">
<div class="form-group"><label>Trigger</label><select onchange="updatePreview()"><option>New Lease</option><option>Renewal</option><option>Tour Milestone</option><option>Occupancy Target</option><option>NOI Target</option><option>WO SLA</option><option>Attendance</option><option>Custom</option></select></div>
<div class="form-group"><label>Rate Type</label><select onchange="updatePreview()"><option>Flat $</option><option>Per-unit $</option><option>% of Rent</option><option>% of NOI</option><option>Monthly</option><option>Quarterly</option><option>Annual</option></select></div>
<div class="form-group"><label>Amount</label><input type="text" placeholder="e.g., $100" oninput="updatePreview()"></div>
<div class="form-group"><label>Threshold</label><input type="text" placeholder="e.g., >15/month" oninput="updatePreview()"></div>
<div class="form-group"><label>Cap</label><input type="text" placeholder="e.g., $2,000/mo" oninput="updatePreview()"></div>
</div>`;
document.getElementById('componentsList').appendChild(div);
updatePreview();
}

function updatePreview(){
const name=document.getElementById('planName').value||'Untitled Plan';
const title=document.getElementById('planTitle').value||'‚Äî';
const sel=document.getElementById('planPropType');
const types=Array.from(sel.selectedOptions).map(o=>o.text).join(', ')||'‚Äî';
const start=document.getElementById('planStart').value;
const end=document.getElementById('planEnd').value;
const sd=document.getElementById('planStartDate').value;
const comps=document.querySelectorAll('#componentsList .component-card');
let rows='';
comps.forEach(c=>{
const selects=c.querySelectorAll('select');
const inputs=c.querySelectorAll('input');
rows+=`<tr><td>${selects[0]?.value||'‚Äî'}</td><td>${selects[1]?.value||'‚Äî'}</td><td>${inputs[0]?.value||'‚Äî'}</td><td>${inputs[1]?.value||'‚Äî'}</td><td>${inputs[2]?.value||'‚Äî'}</td></tr>`;
});
let proNote='';
if(sd){
const d=new Date(sd);
const dom=d.getDate(),dim=new Date(d.getFullYear(),d.getMonth()+1,0).getDate();
const dw=dim-dom+1;
proNote=`<div style="margin-top:10px;padding:8px;background:#fff3cd;border-radius:6px;font-size:.82rem">‚ö° <strong>Pro-rated:</strong> ${dw}/${dim} days (${(dw/dim*100).toFixed(1)}%) ‚Äî commissions & bonuses adjusted for mid-period start</div>`;
}
document.getElementById('previewContent').innerHTML=`
<div style="margin-bottom:12px"><strong style="font-size:1.1rem;color:var(--navy)">${name}</strong></div>
<div class="mb" style="font-size:.85rem"><strong>Property Types:</strong> ${types}</div>
<div class="mb" style="font-size:.85rem"><strong>Title:</strong> ${title}</div>
<div class="mb" style="font-size:.85rem"><strong>Period:</strong> ${start} to ${end}</div>
${comps.length?`<table><thead><tr><th>Trigger</th><th>Rate Type</th><th>Amount</th><th>Threshold</th><th>Cap</th></tr></thead><tbody>${rows}</tbody></table>`:'<p class="text-muted">Add components to see preview</p>'}
${proNote}
<div style="margin-top:10px">
<div class="approval-flow" style="font-size:.75rem">
<span class="flow-step pending" style="padding:3px 8px">Employee Acknowledges</span><span class="flow-arrow">‚Üí</span>
<span class="flow-step pending" style="padding:3px 8px">Supervisor Approves</span><span class="flow-arrow">‚Üí</span>
<span class="flow-step pending" style="padding:3px 8px">Senior Approves</span>
</div>
</div>`;
}

// PAF actions
function approveRow(btn){btn.closest('tr').querySelector('td:last-child').innerHTML='<span class="badge badge-green">Approved ‚úì</span>';}
function denyRow(btn){btn.closest('tr').querySelector('td:last-child').innerHTML='<span class="badge badge-red">Denied ‚úó</span>';}
function returnRow(btn){btn.closest('tr').querySelector('td:last-child').innerHTML='<span class="badge badge-amber">Returned ‚Ü©</span>';}

function resizeLeaderboards(){
renderLeaderboard(document.getElementById('empLeaderboard'),nonStudentLB,'Sarah Mitchell');
renderLeaderboard(document.getElementById('teamLeaderboard'),teamLBData,'Sarah Mitchell');
}

// Init
window.addEventListener('DOMContentLoaded',()=>{
resizeLeaderboards();
renderTeamCards();
renderStructures();
updatePreview();
updateProration();
});
window.addEventListener('resize',resizeLeaderboards);
</script>
</body>
</html>